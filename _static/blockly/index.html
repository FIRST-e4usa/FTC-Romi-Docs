<html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="css/blocks_offline.css">
    <link rel="stylesheet" type="text/css" href="css/blocks_common_less.css">
    <link rel="stylesheet" type="text/css" href="css/blocks_common.css">

    <script type="text/javascript" src="js/split.min.js"></script>

    <script type="text/javascript" src="blockly/blockly_compressed.js"></script>
    <script type="text/javascript" src="blockly/msg/messages.js"></script>
    <script type="text/javascript" src="blockly/blocks_compressed.js"></script>
    <script type="text/javascript" src="blockly/javascript_compressed.js"></script>

    <script type="text/javascript" src="ftcblockly/generators/ftcjava.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/lists.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/logic.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/loops.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/math.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/procedures.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/text.js"></script>
    <script type="text/javascript" src="ftcblockly/generators/ftcjava/variables.js"></script>

    <script type="text/javascript" src="js/FtcOfflineBlocks.js"></script>
    <script type="text/javascript" src="blocks/FtcBlocks_common.js"></script>

    <script type="text/javascript" src="blocks/acceleration.js"></script>
    <script type="text/javascript" src="blocks/acceleration_sensor.js"></script>
    <script type="text/javascript" src="blocks/analog_input.js"></script>
    <script type="text/javascript" src="blocks/analog_output.js"></script>
    <script type="text/javascript" src="blocks/android_accelerometer.js"></script>
    <script type="text/javascript" src="blocks/android_gyroscope.js"></script>
    <script type="text/javascript" src="blocks/android_orientation.js"></script>
    <script type="text/javascript" src="blocks/android_sound_pool.js"></script>
    <script type="text/javascript" src="blocks/android_text_to_speech.js"></script>
    <script type="text/javascript" src="blocks/angular_velocity.js"></script>
    <script type="text/javascript" src="blocks/bno055imu.js"></script>
    <script type="text/javascript" src="blocks/bno055imu_parameters.js"></script>
    <script type="text/javascript" src="blocks/clipboard_util.js"></script>
    <script type="text/javascript" src="blocks/color.js"></script>
    <script type="text/javascript" src="blocks/color_range_sensor.js"></script>
    <script type="text/javascript" src="blocks/color_sensor.js"></script>
    <script type="text/javascript" src="blocks/compass_sensor.js"></script>
    <script type="text/javascript" src="blocks/cr_servo.js"></script>
    <script type="text/javascript" src="blocks/dbg_log.js"></script>
    <script type="text/javascript" src="blocks/dc_motor.js"></script>
    <script type="text/javascript" src="blocks/digital_channel.js"></script>
    <script type="text/javascript" src="blocks/distance_sensor.js"></script>
    <script type="text/javascript" src="blocks/elapsed_time.js"></script>
    <script type="text/javascript" src="blocks/elapsed_time2.js"></script>
    <script type="text/javascript" src="blocks/gamepad.js"></script>
    <script type="text/javascript" src="blocks/gyro_sensor.js"></script>
    <script type="text/javascript" src="blocks/hardware_util.js"></script>
    <script type="text/javascript" src="blocks/ir_seeker_sensor.js"></script>
    <script type="text/javascript" src="blocks/led.js"></script>
    <script type="text/javascript" src="blocks/light_sensor.js"></script>
    <script type="text/javascript" src="blocks/linear_op_mode.js"></script>
    <script type="text/javascript" src="blocks/locale.js"></script>
    <script type="text/javascript" src="blocks/magnetic_flux.js"></script>
    <script type="text/javascript" src="blocks/matrix_f.js"></script>
    <script type="text/javascript" src="blocks/misc.js"></script>
    <script type="text/javascript" src="blocks/mr_i2c_compass_sensor.js"></script>
    <script type="text/javascript" src="blocks/mr_i2c_range_sensor.js"></script>
    <script type="text/javascript" src="blocks/navigation.js"></script>
    <script type="text/javascript" src="blocks/open_gl_matrix.js"></script>
    <script type="text/javascript" src="blocks/optical_distance_sensor.js"></script>
    <script type="text/javascript" src="blocks/orientation.js"></script>
    <script type="text/javascript" src="blocks/pidf_coefficients.js"></script>
    <script type="text/javascript" src="blocks/position.js"></script>
    <script type="text/javascript" src="blocks/project_util.js"></script>
    <script type="text/javascript" src="blocks/quaternion.js"></script>
    <script type="text/javascript" src="blocks/range.js"></script>
    <script type="text/javascript" src="blocks/rev_blinkin_led_driver.js"></script>
    <script type="text/javascript" src="blocks/servo.js"></script>
    <script type="text/javascript" src="blocks/servo_controller.js"></script>
    <!-- sound_util.js is not needed -->
    <script type="text/javascript" src="blocks/system.js"></script>
    <script type="text/javascript" src="blocks/telemetry.js"></script>
    <script type="text/javascript" src="blocks/temperature.js"></script>
    <script type="text/javascript" src="blocks/tfod.js"></script>
    <script type="text/javascript" src="blocks/tfod_current_game.js"></script>
    <script type="text/javascript" src="blocks/tfod_custom_model.js"></script>
    <script type="text/javascript" src="blocks/tfod_recognition.js"></script>
    <script type="text/javascript" src="blocks/tfod_rover_ruckus.js"></script>
    <script type="text/javascript" src="blocks/tfod_sky_stone.js"></script>
    <script type="text/javascript" src="blocks/toolbox_util.js"></script>
    <script type="text/javascript" src="blocks/touch_sensor.js"></script>
    <script type="text/javascript" src="blocks/ultrasonic_sensor.js"></script>
    <script type="text/javascript" src="blocks/vars.js"></script>
    <script type="text/javascript" src="blocks/vector_f.js"></script>
    <script type="text/javascript" src="blocks/velocity.js"></script>
    <script type="text/javascript" src="blocks/voltage_sensor.js"></script>
    <script type="text/javascript" src="blocks/vuforia.js"></script>
    <script type="text/javascript" src="blocks/vuforia_current_game.js"></script>
    <script type="text/javascript" src="blocks/vuforia_localizer.js"></script>
    <script type="text/javascript" src="blocks/vuforia_localizer_parameters.js"></script>
    <script type="text/javascript" src="blocks/vuforia_relic_recovery.js"></script>
    <script type="text/javascript" src="blocks/vuforia_rover_ruckus.js"></script>
    <script type="text/javascript" src="blocks/vuforia_sky_stone.js"></script>
    <script type="text/javascript" src="blocks/vuforia_trackable.js"></script>
    <script type="text/javascript" src="blocks/vuforia_trackable_default_listener.js"></script>
    <script type="text/javascript" src="blocks/vuforia_trackables.js"></script>
  </head>
  <body>
    <div id="blocklyDivArea" style="width: 100%; height: 100%">
      <div style="position: absolute; top: 0; left: 0; bottom: 0; right: 0; z-index: 999"></div>
      <div id="blocklyDiv"></div>
    </div>

    <script>
      waitForVisible = () => {
        if(isVisible()) {
          init();
          console.log("Initialized blocks");
        } else {
          setTimeout(waitForVisible, 20);
        }
      }
      waitForVisible();

      function isVisible() {
        return window.frameElement.parentElement.hidden !== true;
      }

      function init() {
        var blocksUrl = window.frameElement.getAttribute("blocks-url");

        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", blocksUrl, false);
        xmlHttp.send(null);
        var res = xmlHttp.responseText;

        var resXml = Blockly.Xml.textToDom(res);

        var workspace = Blockly.inject('blocklyDiv', {
          readOnly: true,
          zoom: {
            controls: false,
            wheel: true,
            startScale: 1,
            maxScale: 5,
            minScale: 0.3,
            scaleSpeed: 1
          },
        });

        workspace.addTopBlock(Blockly.Xml.domToBlock(resXml, workspace));
        workspace.zoomToFit()
        workspace.translate(0, 0)
      }
    </script>
  </body>
</html>